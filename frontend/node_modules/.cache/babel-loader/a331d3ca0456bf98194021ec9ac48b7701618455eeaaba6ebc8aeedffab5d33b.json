{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { ref, onMounted, nextTick, onUnmounted, watch } from 'vue';\nimport { api } from '../api/index';\nimport { Network, DataSet } from 'vis-network/standalone';\nimport { ElButton, ElMessage, ElInput } from 'element-plus';\n// 原有导入保留，新增：导入全屏图标\nimport { Fullscreen, FullscreenExit } from '@element-plus/icons-vue';\n\n// 接收父组件传递的核心实体\n\nexport default {\n  __name: 'GraphVisual',\n  props: {\n    mainEntity: {\n      type: String,\n      default: ''\n    }\n  },\n  emits: ['update:currentEntity'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n\n    // 向父组件发送当前选中的实体\n    const emit = __emit;\n\n    // 响应式数据\n    const graphRef = ref(null);\n    const network = ref(null); // 图谱实例（初始为null）\n    const loading = ref(true);\n    const searchEntity = ref('');\n    const currentEntity = ref('');\n    // 原有响应式数据保留，新增：全屏状态标识\n    const isFullScreen = ref(false); // 控制全屏状态\n\n    // 销毁图谱实例（增加非空校验）\n    const destroyNetwork = () => {\n      if (network.value) {\n        // 先移除所有事件监听，再销毁\n        network.value.off('stabilizationIterationsDone');\n        network.value.off('click');\n        network.value.destroy();\n        network.value = null; // 销毁后重置为null\n      }\n    };\n\n    // 初始化图谱（核心修复：全程非空校验）\n    const initGraph = async (targetEntity = '') => {\n      try {\n        loading.value = true;\n        destroyNetwork(); // 先销毁旧实例，避免内存泄漏\n\n        // 等待DOM完全渲染\n        await nextTick();\n\n        // 1. 校验DOM容器\n        if (!graphRef.value) {\n          ElMessage.error('图谱容器不存在，无法初始化！');\n          loading.value = false;\n          return; // 终止执行，避免后续报错\n        }\n\n        // 2. 校验容器尺寸\n        const rect = graphRef.value.getBoundingClientRect();\n        if (rect.width === 0 || rect.height === 0) {\n          ElMessage.error('图谱容器无有效尺寸，请检查布局！');\n          loading.value = false;\n          return; // 终止执行\n        }\n\n        // 3.确定当前实体（强制处理空值）\n        let entity = typeof targetEntity === 'string' ? targetEntity.trim() : '';\n        // 关键：如果明确传递空字符串，强制使用空实体（覆盖父组件传递的实体）\n        entity = targetEntity === '' ? '' : entity || currentEntity.value || props.mainEntity;\n        currentEntity.value = entity;\n        emit('update:currentEntity', entity);\n\n        // 4. 获取图谱数据\n        let res;\n        try {\n          if (entity) {\n            res = await api.getGraphDataByEntity(entity);\n          } else {\n            // 无实体：强制调用全量接口（核心修复）\n            res = await api.getGraphData();\n            console.log('加载全量图谱数据：', res.data); // 调试日志\n          }\n        } catch (dataError) {\n          ElMessage.error(`获取图谱数据失败：${dataError.message}`);\n          loading.value = false;\n          return; // 数据获取失败，终止执行\n        }\n        const {\n          nodes,\n          edges\n        } = res.data;\n\n        // 5. 校验数据有效性\n        if (!nodes || !nodes.length) {\n          ElMessage.warning(entity ? `未找到「${entity}」相关图谱数据` : '暂无图谱数据');\n          loading.value = false;\n          return; // 无数据，终止执行\n        }\n\n        // 6. 格式化数据\n        const visNodes = new DataSet(nodes.map(node => ({\n          id: node.id || node.label,\n          label: node.label || node.id,\n          shape: 'ellipse',\n          size: 25,\n          color: {\n            background: node.id === entity ? '#67C23A' : '#409EFF',\n            border: node.id === entity ? '#529B2E' : '#1989FA'\n          }\n        })));\n        const visEdges = new DataSet(edges.map(edge => ({\n          from: edge.from,\n          to: edge.to,\n          label: edge.label || edge.relation,\n          width: 2,\n          color: '#999',\n          arrows: {\n            to: {\n              enabled: true,\n              scaleFactor: 0.7\n            }\n          }\n        })));\n\n        // 7. 图谱配置\n        const options = {\n          nodes: {\n            font: {\n              size: 14,\n              color: '#333'\n            }\n          },\n          edges: {\n            font: {\n              size: 12,\n              align: 'middle'\n            }\n          },\n          physics: {\n            enabled: true,\n            stabilization: {\n              enabled: true,\n              iterations: 500,\n              fit: true\n            },\n            barnesHut: {\n              gravitationalConstant: -2000,\n              centralGravity: 0.3,\n              springLength: 200,\n              springConstant: 0.04,\n              damping: 0.09,\n              avoidOverlap: 0.1\n            }\n          },\n          interaction: {\n            hover: true,\n            tooltipDelay: 200,\n            dragNodes: true,\n            zoomView: true\n          }\n        };\n\n        // 8. 创建图谱实例（核心：确保实例创建成功）\n        try {\n          network.value = new Network(graphRef.value, {\n            nodes: visNodes,\n            edges: visEdges\n          }, options);\n        } catch (initError) {\n          ElMessage.error(`图谱实例创建失败：${initError.message}`);\n          loading.value = false;\n          return; // 实例创建失败，终止执行\n        }\n\n        // 9. 绑定事件（关键：先校验network.value非空）\n        if (network.value) {\n          // 绑定稳定完成事件\n          network.value.on('stabilizationIterationsDone', () => {\n            loading.value = false;\n            network.value?.setOptions({\n              physics: {\n                enabled: true\n              }\n            }); // 可选链操作\n            // 聚焦核心实体（增加非空校验）\n            if (entity && network.value) {\n              network.value.focus(entity, {\n                scale: 1.2,\n                animation: true\n              });\n            }\n          });\n\n          // 绑定节点点击事件\n          network.value.on('click', params => {\n            if (params.nodes.length > 0 && network.value) {\n              // 非空校验\n              const nodeId = params.nodes[0];\n              searchEntity.value = nodeId;\n              handleSearch(); // 直接调用，不传递参数\n            }\n          });\n        }\n      } catch (error) {\n        ElMessage.error(`图谱初始化失败：${error.message}`);\n        loading.value = false;\n        destroyNetwork(); // 异常时销毁实例\n      }\n    };\n\n    // 处理搜索（移除参数，避免接收KeyboardEvent）\n    const handleSearch = () => {\n      let entity = searchEntity.value.trim();\n      // 过滤非法字符\n      entity = entity.replace(/\\[object .+\\]/g, '').trim();\n      if (!entity) {\n        ElMessage.warning('请输入有效的节点名称！');\n        return;\n      }\n      currentEntity.value = entity;\n      initGraph(entity);\n    };\n\n    // 显示全量图谱（完整重置状态）\n    const showAllGraph = () => {\n      // 1. 清空搜索框\n      searchEntity.value = '';\n      // 2. 重置当前实体（关键：彻底清除实体状态）\n      currentEntity.value = '';\n      // 3. 通知父组件清除实体（确保联动状态一致）\n      emit('update:currentEntity', '');\n      // 4. 强制加载全量数据（传递空字符串明确标识全量）\n      initGraph('');\n    };\n\n    // 监听问答面板实体变化（增加防抖）\n    watch(() => props.mainEntity, newEntity => {\n      if (!currentEntity.value) {\n        initGraph(newEntity);\n      }\n    }, {\n      immediate: true,\n      flush: 'post'\n    } // 延迟执行，确保DOM更新\n    );\n\n    // 挂载后初始化（增加延迟，确保DOM渲染完成）\n    onMounted(async () => {\n      await nextTick();\n      setTimeout(() => {\n        initGraph();\n      }, 300); // 延迟300ms，兼容慢渲染场景\n\n      // 窗口resize监听（增加非空校验）\n      window.addEventListener('resize', () => {\n        if (network.value) {\n          network.value.redraw();\n        }\n      });\n      // 新增：绑定全屏事件监听\n      document.addEventListener('fullscreenchange', handleFullScreenChange);\n      document.addEventListener('webkitfullscreenchange', handleFullScreenChange);\n      document.addEventListener('msfullscreenchange', handleFullScreenChange);\n    });\n    // 新增：全屏切换核心方法\n    const toggleFullScreen = () => {\n      // 获取图谱容器DOM\n      const container = document.querySelector('.graph-container');\n      if (!container) return;\n      try {\n        if (!isFullScreen.value) {\n          // 进入全屏（兼容多浏览器）\n          if (container.requestFullscreen) {\n            container.requestFullscreen();\n          } else if (container.webkitRequestFullscreen) {\n            // Chrome/Safari\n            container.webkitRequestFullscreen();\n          } else if (container.msRequestFullscreen) {\n            // IE/Edge\n            container.msRequestFullscreen();\n          }\n          ElMessage.success('已进入图谱全屏模式，按ESC键可退出');\n        } else {\n          // 退出全屏（兼容多浏览器）\n          if (document.exitFullscreen) {\n            document.exitFullscreen();\n          } else if (document.webkitExitFullscreen) {\n            document.webkitExitFullscreen();\n          } else if (document.msExitFullscreen) {\n            document.msExitFullscreen();\n          }\n          ElMessage.info('已退出图谱全屏模式');\n        }\n      } catch (error) {\n        ElMessage.error(`全屏操作失败：${error.message}`);\n      }\n    };\n\n    // 新增：监听全屏状态变化（同步isFullScreen，并重绘图谱）\n    const handleFullScreenChange = () => {\n      // 检测当前是否处于全屏状态（兼容多浏览器）\n      const fullscreenElement = document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement;\n      isFullScreen.value = !!fullscreenElement;\n\n      // 全屏状态变化时重绘图谱，避免尺寸异常\n      if (network.value) {\n        network.value.redraw();\n      }\n    };\n    // 卸载时销毁（增加非空校验）\n    onUnmounted(() => {\n      destroyNetwork();\n      window.removeEventListener('resize', () => {});\n    });\n    const __returned__ = {\n      props,\n      emit,\n      graphRef,\n      network,\n      loading,\n      searchEntity,\n      currentEntity,\n      isFullScreen,\n      destroyNetwork,\n      initGraph,\n      handleSearch,\n      showAllGraph,\n      toggleFullScreen,\n      handleFullScreenChange,\n      ref,\n      onMounted,\n      nextTick,\n      onUnmounted,\n      watch,\n      get api() {\n        return api;\n      },\n      get Network() {\n        return Network;\n      },\n      get DataSet() {\n        return DataSet;\n      },\n      get ElButton() {\n        return ElButton;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get ElInput() {\n        return ElInput;\n      },\n      get Fullscreen() {\n        return Fullscreen;\n      },\n      get FullscreenExit() {\n        return FullscreenExit;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","nextTick","onUnmounted","watch","api","Network","DataSet","ElButton","ElMessage","ElInput","Fullscreen","FullscreenExit","props","__props","emit","__emit","graphRef","network","loading","searchEntity","currentEntity","isFullScreen","destroyNetwork","value","off","destroy","initGraph","targetEntity","error","rect","getBoundingClientRect","width","height","entity","trim","mainEntity","res","getGraphDataByEntity","getGraphData","console","log","data","dataError","message","nodes","edges","length","warning","visNodes","map","node","id","label","shape","size","color","background","border","visEdges","edge","from","to","relation","arrows","enabled","scaleFactor","options","font","align","physics","stabilization","iterations","fit","barnesHut","gravitationalConstant","centralGravity","springLength","springConstant","damping","avoidOverlap","interaction","hover","tooltipDelay","dragNodes","zoomView","initError","on","setOptions","focus","scale","animation","params","nodeId","handleSearch","replace","showAllGraph","newEntity","immediate","flush","setTimeout","window","addEventListener","redraw","document","handleFullScreenChange","toggleFullScreen","container","querySelector","requestFullscreen","webkitRequestFullscreen","msRequestFullscreen","success","exitFullscreen","webkitExitFullscreen","msExitFullscreen","info","fullscreenElement","webkitFullscreenElement","msFullscreenElement","removeEventListener"],"sources":["D:/前端大作业/kg-system/frontend/src/components/GraphVisual.vue"],"sourcesContent":["<template>\r\n  <div class=\"graph-wrapper\" style=\"width: 100%; height: 550px; position: relative;\">\r\n    <div class=\"search-bar\" style=\"margin-bottom: 10px; display: flex; gap: 10px;\">\r\n      <el-input\r\n        v-model=\"searchEntity\"\r\n        placeholder=\"输入节点名称搜索（如Vue、Vite、ES6）\"\r\n        clearable\r\n        style=\"flex: 1;\"\r\n        @keyup.enter=\"handleSearch\"\r\n      ></el-input>\r\n      <el-button type=\"primary\" @click=\"handleSearch\">搜索</el-button>\r\n      <el-button @click=\"showAllGraph\">显示全部</el-button>\r\n      <!-- 新增：全屏按钮（带图标） -->\r\n      <el-button \r\n        type=\"primary\" \r\n        @click=\"toggleFullScreen\"\r\n        icon=\"Fullscreen\"  \r\n        circle\r\n        title=\"全屏展示图谱\"\r\n      >全屏</el-button>\r\n    </div>\r\n\r\n    <!-- 修改：给图谱容器添加动态class，用于全屏样式控制 -->\r\n    <div :class=\"['graph-container', { 'fullscreen': isFullScreen }]\" style=\"width: 100%; height: 500px; position: relative;\">\r\n      <div v-if=\"loading\" class=\"loading\">\r\n        {{ currentEntity ? `加载「${currentEntity}」相关图谱...` : '加载知识图谱中...' }}\r\n      </div>\r\n      <div \r\n        ref=\"graphRef\" \r\n        style=\"width: 100%; height: 100%; border: 1px solid #e6e6e6; border-radius: 8px;\"\r\n      ></div>\r\n      <el-button \r\n        type=\"text\" \r\n        @click=\"initGraph\" \r\n        style=\"position: absolute; bottom: 10px; right: 10px;\"\r\n      >\r\n        重新加载\r\n      </el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script setup>\r\nimport { ref, onMounted, nextTick, onUnmounted, watch, defineProps, defineEmits } from 'vue';\r\nimport { api } from '../api/index';\r\nimport { Network, DataSet } from 'vis-network/standalone';\r\nimport { ElButton, ElMessage, ElInput } from 'element-plus';\r\n// 原有导入保留，新增：导入全屏图标\r\nimport { Fullscreen, FullscreenExit } from '@element-plus/icons-vue';\r\n\r\n// 接收父组件传递的核心实体\r\nconst props = defineProps({\r\n  mainEntity: {\r\n    type: String,\r\n    default: ''\r\n  }\r\n});\r\n\r\n// 向父组件发送当前选中的实体\r\nconst emit = defineEmits(['update:currentEntity']);\r\n\r\n// 响应式数据\r\nconst graphRef = ref(null);\r\nconst network = ref(null); // 图谱实例（初始为null）\r\nconst loading = ref(true);\r\nconst searchEntity = ref('');\r\nconst currentEntity = ref('');\r\n// 原有响应式数据保留，新增：全屏状态标识\r\nconst isFullScreen = ref(false); // 控制全屏状态\r\n\r\n// 销毁图谱实例（增加非空校验）\r\nconst destroyNetwork = () => {\r\n  if (network.value) {\r\n    // 先移除所有事件监听，再销毁\r\n    network.value.off('stabilizationIterationsDone');\r\n    network.value.off('click');\r\n    network.value.destroy();\r\n    network.value = null; // 销毁后重置为null\r\n  }\r\n};\r\n\r\n// 初始化图谱（核心修复：全程非空校验）\r\nconst initGraph = async (targetEntity = '') => {\r\n  try {\r\n    loading.value = true;\r\n    destroyNetwork(); // 先销毁旧实例，避免内存泄漏\r\n\r\n    // 等待DOM完全渲染\r\n    await nextTick();\r\n\r\n    // 1. 校验DOM容器\r\n    if (!graphRef.value) {\r\n      ElMessage.error('图谱容器不存在，无法初始化！');\r\n      loading.value = false;\r\n      return; // 终止执行，避免后续报错\r\n    }\r\n\r\n    // 2. 校验容器尺寸\r\n    const rect = graphRef.value.getBoundingClientRect();\r\n    if (rect.width === 0 || rect.height === 0) {\r\n      ElMessage.error('图谱容器无有效尺寸，请检查布局！');\r\n      loading.value = false;\r\n      return; // 终止执行\r\n    }\r\n\r\n    // 3.确定当前实体（强制处理空值）\r\n    let entity = typeof targetEntity === 'string' ? targetEntity.trim() : '';\r\n    // 关键：如果明确传递空字符串，强制使用空实体（覆盖父组件传递的实体）\r\n    entity = targetEntity === '' ? '' : (entity || currentEntity.value || props.mainEntity);\r\n    currentEntity.value = entity;\r\n    emit('update:currentEntity', entity);\r\n\r\n    // 4. 获取图谱数据\r\n    let res;\r\n    try {\r\n      if (entity) {\r\n        res = await api.getGraphDataByEntity(entity);\r\n      } else {\r\n        // 无实体：强制调用全量接口（核心修复）\r\n      res = await api.getGraphData();\r\n      console.log('加载全量图谱数据：', res.data); // 调试日志\r\n      }\r\n    } catch (dataError) {\r\n      ElMessage.error(`获取图谱数据失败：${dataError.message}`);\r\n      loading.value = false;\r\n      return; // 数据获取失败，终止执行\r\n    }\r\n\r\n    const { nodes, edges } = res.data;\r\n\r\n    // 5. 校验数据有效性\r\n    if (!nodes || !nodes.length) {\r\n      ElMessage.warning(entity ? `未找到「${entity}」相关图谱数据` : '暂无图谱数据');\r\n      loading.value = false;\r\n      return; // 无数据，终止执行\r\n    }\r\n\r\n    // 6. 格式化数据\r\n    const visNodes = new DataSet(\r\n      nodes.map(node => ({\r\n        id: node.id || node.label,\r\n        label: node.label || node.id,\r\n        shape: 'ellipse',\r\n        size: 25,\r\n        color: { \r\n          background: node.id === entity ? '#67C23A' : '#409EFF',\r\n          border: node.id === entity ? '#529B2E' : '#1989FA' \r\n        }\r\n      }))\r\n    );\r\n\r\n    const visEdges = new DataSet(\r\n      edges.map(edge => ({\r\n        from: edge.from,\r\n        to: edge.to,\r\n        label: edge.label || edge.relation,\r\n        width: 2,\r\n        color: '#999',\r\n        arrows: { to: { enabled: true, scaleFactor: 0.7 } }\r\n      }))\r\n    );\r\n\r\n    // 7. 图谱配置\r\n    const options = {\r\n      nodes: { font: { size: 14, color: '#333' } },\r\n      edges: { font: { size: 12, align: 'middle' } },\r\n      physics: {\r\n        enabled: true,\r\n        stabilization: { enabled: true, iterations: 500, fit: true },\r\n        barnesHut: {\r\n          gravitationalConstant: -2000,\r\n          centralGravity: 0.3,\r\n          springLength: 200,\r\n          springConstant: 0.04,\r\n          damping: 0.09,\r\n          avoidOverlap: 0.1\r\n        }\r\n      },\r\n      interaction: { \r\n        hover: true, \r\n        tooltipDelay: 200,\r\n        dragNodes: true,\r\n        zoomView: true\r\n      }\r\n    };\r\n\r\n    // 8. 创建图谱实例（核心：确保实例创建成功）\r\n    try {\r\n      network.value = new Network(graphRef.value, { nodes: visNodes, edges: visEdges }, options);\r\n    } catch (initError) {\r\n      ElMessage.error(`图谱实例创建失败：${initError.message}`);\r\n      loading.value = false;\r\n      return; // 实例创建失败，终止执行\r\n    }\r\n\r\n    // 9. 绑定事件（关键：先校验network.value非空）\r\n    if (network.value) {\r\n      // 绑定稳定完成事件\r\n      network.value.on('stabilizationIterationsDone', () => {\r\n        loading.value = false;\r\n        network.value?.setOptions({ physics: { enabled: true } }); // 可选链操作\r\n        // 聚焦核心实体（增加非空校验）\r\n        if (entity && network.value) {\r\n          network.value.focus(entity, { scale: 1.2, animation: true });\r\n        }\r\n      });\r\n\r\n      // 绑定节点点击事件\r\n      network.value.on('click', (params) => {\r\n        if (params.nodes.length > 0 && network.value) { // 非空校验\r\n          const nodeId = params.nodes[0];\r\n          searchEntity.value = nodeId;\r\n          handleSearch(); // 直接调用，不传递参数\r\n        }\r\n      });\r\n    }\r\n\r\n  } catch (error) {\r\n    ElMessage.error(`图谱初始化失败：${error.message}`);\r\n    loading.value = false;\r\n    destroyNetwork(); // 异常时销毁实例\r\n  }\r\n};\r\n\r\n// 处理搜索（移除参数，避免接收KeyboardEvent）\r\nconst handleSearch = () => {\r\n  let entity = searchEntity.value.trim();\r\n  // 过滤非法字符\r\n  entity = entity.replace(/\\[object .+\\]/g, '').trim();\r\n  if (!entity) {\r\n    ElMessage.warning('请输入有效的节点名称！');\r\n    return;\r\n  }\r\n  currentEntity.value = entity;\r\n  initGraph(entity);\r\n};\r\n\r\n// 显示全量图谱（完整重置状态）\r\nconst showAllGraph = () => {\r\n  // 1. 清空搜索框\r\n  searchEntity.value = '';\r\n  // 2. 重置当前实体（关键：彻底清除实体状态）\r\n  currentEntity.value = '';\r\n  // 3. 通知父组件清除实体（确保联动状态一致）\r\n  emit('update:currentEntity', '');\r\n  // 4. 强制加载全量数据（传递空字符串明确标识全量）\r\n  initGraph('');\r\n};\r\n\r\n// 监听问答面板实体变化（增加防抖）\r\nwatch(\r\n  () => props.mainEntity,\r\n  (newEntity) => {\r\n    if (!currentEntity.value) {\r\n      initGraph(newEntity);\r\n    }\r\n  },\r\n  { immediate: true, flush: 'post' } // 延迟执行，确保DOM更新\r\n);\r\n\r\n// 挂载后初始化（增加延迟，确保DOM渲染完成）\r\nonMounted(async () => {\r\n  await nextTick();\r\n  setTimeout(() => {\r\n    initGraph();\r\n  }, 300); // 延迟300ms，兼容慢渲染场景\r\n\r\n  // 窗口resize监听（增加非空校验）\r\n  window.addEventListener('resize', () => {\r\n    if (network.value) {\r\n      network.value.redraw();\r\n    }\r\n  });\r\n  // 新增：绑定全屏事件监听\r\n  document.addEventListener('fullscreenchange', handleFullScreenChange);\r\n  document.addEventListener('webkitfullscreenchange', handleFullScreenChange);\r\n  document.addEventListener('msfullscreenchange', handleFullScreenChange);\r\n});\r\n// 新增：全屏切换核心方法\r\nconst toggleFullScreen = () => {\r\n  // 获取图谱容器DOM\r\n  const container = document.querySelector('.graph-container');\r\n  if (!container) return;\r\n\r\n  try {\r\n    if (!isFullScreen.value) {\r\n      // 进入全屏（兼容多浏览器）\r\n      if (container.requestFullscreen) {\r\n        container.requestFullscreen();\r\n      } else if (container.webkitRequestFullscreen) { // Chrome/Safari\r\n        container.webkitRequestFullscreen();\r\n      } else if (container.msRequestFullscreen) { // IE/Edge\r\n        container.msRequestFullscreen();\r\n      }\r\n      ElMessage.success('已进入图谱全屏模式，按ESC键可退出');\r\n    } else {\r\n      // 退出全屏（兼容多浏览器）\r\n      if (document.exitFullscreen) {\r\n        document.exitFullscreen();\r\n      } else if (document.webkitExitFullscreen) {\r\n        document.webkitExitFullscreen();\r\n      } else if (document.msExitFullscreen) {\r\n        document.msExitFullscreen();\r\n      }\r\n      ElMessage.info('已退出图谱全屏模式');\r\n    }\r\n  } catch (error) {\r\n    ElMessage.error(`全屏操作失败：${error.message}`);\r\n  }\r\n};\r\n\r\n// 新增：监听全屏状态变化（同步isFullScreen，并重绘图谱）\r\nconst handleFullScreenChange = () => {\r\n  // 检测当前是否处于全屏状态（兼容多浏览器）\r\n  const fullscreenElement = document.fullscreenElement || \r\n                            document.webkitFullscreenElement || \r\n                            document.msFullscreenElement;\r\n  isFullScreen.value = !!fullscreenElement;\r\n  \r\n  // 全屏状态变化时重绘图谱，避免尺寸异常\r\n  if (network.value) {\r\n    network.value.redraw();\r\n  }\r\n};\r\n// 卸载时销毁（增加非空校验）\r\nonUnmounted(() => {\r\n  destroyNetwork();\r\n  window.removeEventListener('resize', () => {});\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n/* 原有loading样式保留 */\r\n.loading {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: rgba(255, 255, 255, 0.8);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 10;\r\n  font-size: 16px;\r\n  color: #666;\r\n}\r\n\r\n/* 新增：全屏状态下的容器样式 */\r\n.graph-container.fullscreen {\r\n  position: fixed !important;\r\n  top: 0 !important;\r\n  left: 0 !important;\r\n  width: 100vw !important;\r\n  height: 100vh !important;\r\n  z-index: 9999 !important;\r\n  background: white !important;\r\n  border: none !important;\r\n  margin: 0 !important;\r\n  padding: 20px !important;\r\n}\r\n\r\n/* 新增：全屏状态下的图谱内容区样式 */\r\n.graph-container.fullscreen >>> .vis-network {\r\n  width: 100% !important;\r\n  height: 100% !important;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}