{"ast":null,"code":"import { ref, watch } from 'vue';\nimport { ElForm, ElFormItem, ElInput, ElButton, ElCard, ElMessage } from 'element-plus';\nimport { api } from '../api/index';\nimport RecommendPanel from './RecommendPanel.vue';\n\n// 接收父组件传递的图谱选中实体\n\nexport default {\n  __name: 'QaPanel',\n  props: {\n    currentEntity: {\n      type: String,\n      default: ''\n    }\n  },\n  emits: ['update:mainEntity'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n\n    // 定义emit，向父组件传递核心实体\n    const emit = __emit;\n\n    // 响应式数据\n    const question = ref('');\n    const answer = ref('');\n    const recommendations = ref([]);\n    const mainEntity = ref(''); // 核心实体\n    // 新增加载状态变量\n    const isLoading = ref(false);\n\n    // 提交问题\n    const submitQuestion = async () => {\n      if (!question.value.trim()) {\n        ElMessage.warning('请输入问题！');\n        return;\n      }\n      isLoading.value = true; // 开始加载\n      try {\n        const res = await api.qa(question.value);\n        answer.value = res.data.answer;\n        recommendations.value = res.data.recommendations;\n        mainEntity.value = res.data.related_entities[0] || '';\n        emit('update:mainEntity', mainEntity.value);\n      } catch (error) {\n        // 区分超时错误和其他错误\n        if (error.code === 'ECONNABORTED') {\n          ElMessage.error('请求超时，请稍后重试（问题可能较复杂，需要更长时间处理）');\n        } else {\n          ElMessage.error('获取回答失败：' + (error.message || '未知错误'));\n        }\n      } finally {\n        isLoading.value = false; // 无论成功失败，结束加载\n      }\n    };\n\n    // 重置表单\n    const resetForm = () => {\n      question.value = '';\n      answer.value = '';\n      recommendations.value = [];\n      mainEntity.value = '';\n      // 重置时通知父组件清空实体（显示全量图谱）\n      emit('update:mainEntity', '');\n    };\n\n    // 新增：基于图谱选中的实体快速提问\n    const quickAsk = () => {\n      if (props.currentEntity) {\n        question.value = `${props.currentEntity}相关知识有哪些？`;\n        submitQuestion();\n      }\n    };\n\n    // 监听图谱实体变化，自动填充问题（可选）\n    watch(() => props.currentEntity, newEntity => {\n      if (newEntity && !question.value.trim()) {\n        question.value = `${newEntity}相关知识有哪些？`;\n      }\n    }, {\n      immediate: true\n    });\n    const __returned__ = {\n      props,\n      emit,\n      question,\n      answer,\n      recommendations,\n      mainEntity,\n      isLoading,\n      submitQuestion,\n      resetForm,\n      quickAsk,\n      ref,\n      watch,\n      get ElForm() {\n        return ElForm;\n      },\n      get ElFormItem() {\n        return ElFormItem;\n      },\n      get ElInput() {\n        return ElInput;\n      },\n      get ElButton() {\n        return ElButton;\n      },\n      get ElCard() {\n        return ElCard;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get api() {\n        return api;\n      },\n      RecommendPanel\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","watch","ElForm","ElFormItem","ElInput","ElButton","ElCard","ElMessage","api","RecommendPanel","props","__props","emit","__emit","question","answer","recommendations","mainEntity","isLoading","submitQuestion","value","trim","warning","res","qa","data","related_entities","error","code","message","resetForm","quickAsk","currentEntity","newEntity","immediate"],"sources":["D:/前端大作业/kg-system/frontend/src/components/QaPanel.vue"],"sourcesContent":["<template>\r\n  <div class=\"qa-panel\">\r\n    <el-form @submit.prevent=\"submitQuestion\">\r\n      <el-form-item label=\"请输入问题：\">\r\n        <el-input\r\n          v-model=\"question\"\r\n          placeholder=\"例如：Vue3有哪些新特性？Vite的特性是什么？\"\r\n          clearable\r\n          @keyup.enter=\"submitQuestion\"\r\n        ></el-input>\r\n      </el-form-item>\r\n      <!-- 新增：快速提问按钮（基于图谱选中的实体） -->\r\n      <div v-if=\"currentEntity\" style=\"margin-bottom: 10px;\">\r\n        <el-button type=\"text\" @click=\"quickAsk\">快速提问：{{ currentEntity }}相关知识</el-button>\r\n      </div>\r\n      <el-form-item>\r\n        <el-button type=\"primary\" @click=\"submitQuestion\">提交问题</el-button>\r\n        <el-button @click=\"resetForm\">清空</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n\r\n    <!-- 加载状态提示 -->\r\n    <div v-if=\"isLoading\" class=\"loading\">正在生成答案，请稍候...</div>\r\n\r\n    <!-- 回答展示 -->\r\n    <div class=\"answer-container\" v-if=\"answer\">\r\n      <h3>回答：</h3>\r\n      <el-card>\r\n        <pre class=\"answer-text\">{{ answer }}</pre>\r\n      </el-card>\r\n    </div>\r\n\r\n    <!-- 推荐面板 -->\r\n    <RecommendPanel :recommendations=\"recommendations\" />\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, defineEmits, defineProps, watch } from 'vue';\r\nimport { ElForm, ElFormItem, ElInput, ElButton, ElCard, ElMessage } from 'element-plus';\r\nimport { api } from '../api/index';\r\nimport RecommendPanel from './RecommendPanel.vue';\r\n\r\n// 接收父组件传递的图谱选中实体\r\nconst props = defineProps({\r\n  currentEntity: {\r\n    type: String,\r\n    default: ''\r\n  }\r\n});\r\n\r\n// 定义emit，向父组件传递核心实体\r\nconst emit = defineEmits(['update:mainEntity']);\r\n\r\n// 响应式数据\r\nconst question = ref('');\r\nconst answer = ref('');\r\nconst recommendations = ref([]);\r\nconst mainEntity = ref(''); // 核心实体\r\n// 新增加载状态变量\r\nconst isLoading = ref(false);\r\n\r\n// 提交问题\r\nconst submitQuestion = async () => {\r\n  if (!question.value.trim()) {\r\n    ElMessage.warning('请输入问题！');\r\n    return;\r\n  }\r\n\r\n  isLoading.value = true; // 开始加载\r\n  try {\r\n    const res = await api.qa(question.value);\r\n    answer.value = res.data.answer;\r\n    recommendations.value = res.data.recommendations;\r\n    mainEntity.value = res.data.related_entities[0] || '';\r\n    emit('update:mainEntity', mainEntity.value);\r\n  } catch (error) {\r\n    // 区分超时错误和其他错误\r\n    if (error.code === 'ECONNABORTED') {\r\n      ElMessage.error('请求超时，请稍后重试（问题可能较复杂，需要更长时间处理）');\r\n    } else {\r\n      ElMessage.error('获取回答失败：' + (error.message || '未知错误'));\r\n    }\r\n  } finally {\r\n    isLoading.value = false; // 无论成功失败，结束加载\r\n  }\r\n};\r\n\r\n// 重置表单\r\nconst resetForm = () => {\r\n  question.value = '';\r\n  answer.value = '';\r\n  recommendations.value = [];\r\n  mainEntity.value = '';\r\n  // 重置时通知父组件清空实体（显示全量图谱）\r\n  emit('update:mainEntity', '');\r\n};\r\n\r\n// 新增：基于图谱选中的实体快速提问\r\nconst quickAsk = () => {\r\n  if (props.currentEntity) {\r\n    question.value = `${props.currentEntity}相关知识有哪些？`;\r\n    submitQuestion();\r\n  }\r\n};\r\n\r\n// 监听图谱实体变化，自动填充问题（可选）\r\nwatch(\r\n  () => props.currentEntity,\r\n  (newEntity) => {\r\n    if (newEntity && !question.value.trim()) {\r\n      question.value = `${newEntity}相关知识有哪些？`;\r\n    }\r\n  },\r\n  { immediate: true }\r\n);\r\n</script>\r\n\r\n<style scoped>\r\n/* 原有样式不变 */\r\n.qa-panel {\r\n  margin-bottom: 20px;\r\n}\r\n.answer-container {\r\n  margin-top: 20px;\r\n}\r\n.answer-text {\r\n  white-space: pre-wrap;\r\n  font-size: 14px;\r\n  line-height: 1.6;\r\n  color: #333;\r\n  margin: 0;\r\n}\r\n/* 新增加载状态样式 */\r\n.loading {\r\n  margin-top: 20px;\r\n  padding: 20px;\r\n  text-align: center;\r\n  color: #666;\r\n  background: #f5f5f5;\r\n  border-radius: 4px;\r\n}\r\n</style>"],"mappings":"AAsCA,SAASA,GAA6B,EAAEC,KAAK,QAAQ,KAAK;AAC1D,SAASC,MAAM,EAAEC,UAAU,EAAEC,OAAO,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,SAAS,QAAQ,cAAc;AACvF,SAASC,GAAG,QAAQ,cAAc;AAClC,OAAOC,cAAc,MAAM,sBAAsB;;AAEjD;;;;;;;;;;;;;;;;IACA,MAAMC,KAAK,GAAGC,OAKZ;;IAEF;IACA,MAAMC,IAAI,GAAGC,MAAkC;;IAE/C;IACA,MAAMC,QAAQ,GAAGd,GAAG,CAAC,EAAE,CAAC;IACxB,MAAMe,MAAM,GAAGf,GAAG,CAAC,EAAE,CAAC;IACtB,MAAMgB,eAAe,GAAGhB,GAAG,CAAC,EAAE,CAAC;IAC/B,MAAMiB,UAAU,GAAGjB,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;IAC5B;IACA,MAAMkB,SAAS,GAAGlB,GAAG,CAAC,KAAK,CAAC;;IAE5B;IACA,MAAMmB,cAAc,GAAG,MAAAA,CAAA,KAAY;MACjC,IAAI,CAACL,QAAQ,CAACM,KAAK,CAACC,IAAI,CAAC,CAAC,EAAE;QAC1Bd,SAAS,CAACe,OAAO,CAAC,QAAQ,CAAC;QAC3B;MACF;MAEAJ,SAAS,CAACE,KAAK,GAAG,IAAI,CAAC,CAAC;MACxB,IAAI;QACF,MAAMG,GAAG,GAAG,MAAMf,GAAG,CAACgB,EAAE,CAACV,QAAQ,CAACM,KAAK,CAAC;QACxCL,MAAM,CAACK,KAAK,GAAGG,GAAG,CAACE,IAAI,CAACV,MAAM;QAC9BC,eAAe,CAACI,KAAK,GAAGG,GAAG,CAACE,IAAI,CAACT,eAAe;QAChDC,UAAU,CAACG,KAAK,GAAGG,GAAG,CAACE,IAAI,CAACC,gBAAgB,CAAC,CAAC,CAAC,IAAI,EAAE;QACrDd,IAAI,CAAC,mBAAmB,EAAEK,UAAU,CAACG,KAAK,CAAC;MAC7C,CAAC,CAAC,OAAOO,KAAK,EAAE;QACd;QACA,IAAIA,KAAK,CAACC,IAAI,KAAK,cAAc,EAAE;UACjCrB,SAAS,CAACoB,KAAK,CAAC,8BAA8B,CAAC;QACjD,CAAC,MAAM;UACLpB,SAAS,CAACoB,KAAK,CAAC,SAAS,IAAIA,KAAK,CAACE,OAAO,IAAI,MAAM,CAAC,CAAC;QACxD;MACF,CAAC,SAAS;QACRX,SAAS,CAACE,KAAK,GAAG,KAAK,CAAC,CAAC;MAC3B;IACF,CAAC;;IAED;IACA,MAAMU,SAAS,GAAGA,CAAA,KAAM;MACtBhB,QAAQ,CAACM,KAAK,GAAG,EAAE;MACnBL,MAAM,CAACK,KAAK,GAAG,EAAE;MACjBJ,eAAe,CAACI,KAAK,GAAG,EAAE;MAC1BH,UAAU,CAACG,KAAK,GAAG,EAAE;MACrB;MACAR,IAAI,CAAC,mBAAmB,EAAE,EAAE,CAAC;IAC/B,CAAC;;IAED;IACA,MAAMmB,QAAQ,GAAGA,CAAA,KAAM;MACrB,IAAIrB,KAAK,CAACsB,aAAa,EAAE;QACvBlB,QAAQ,CAACM,KAAK,GAAG,GAAGV,KAAK,CAACsB,aAAa,UAAU;QACjDb,cAAc,CAAC,CAAC;MAClB;IACF,CAAC;;IAED;IACAlB,KAAK,CACH,MAAMS,KAAK,CAACsB,aAAa,EACxBC,SAAS,IAAK;MACb,IAAIA,SAAS,IAAI,CAACnB,QAAQ,CAACM,KAAK,CAACC,IAAI,CAAC,CAAC,EAAE;QACvCP,QAAQ,CAACM,KAAK,GAAG,GAAGa,SAAS,UAAU;MACzC;IACF,CAAC,EACD;MAAEC,SAAS,EAAE;IAAK,CACpB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}